plugins {
    id 'com.bmuschko.docker-remote-api'
}

def baseImage = project.property('deephaven.server-requirements.baseImage')

// todo: invalidate if the local image sha changes

Docker.registerDockerImage(project, 'buildDocker') {
    inputDir.set project.layout.projectDirectory.dir('src/main/docker')
    buildArgs.put('BASE', baseImage)
    // TODO: we don't have to explicitly set this if we use buildx
    buildArgs.put('TARGETARCH', 'amd64')
    images.add('deephaven/server-requirements:local-build')
}